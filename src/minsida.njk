---
title: MÃ­n sÃ­Ã°a - FjÃ¶rlistinn
layout: base.njk
---

{# Page-specific CSS #}
<link rel="stylesheet" href="/css/pages/nemandi.css">

<div class="container">
  {# Loading State #}
  <div class="loading" id="minsidaLoading">
    <div class="loading-spinner"></div>
    <p>SÃ¦ki upplÃ½singar...</p>
  </div>

  {# Main Content #}
  <div id="minsidaContent" style="display: none;">
    {# Header #}
    <div class="card" style="text-align: center; margin-bottom: 24px;">
      <h1 id="minsidaNafn" style="font-size: 1.75rem; margin-bottom: 8px;">-</h1>
      <p style="color: var(--color-text-muted);" id="minsidaInfo">-</p>
    </div>

    {# Title & Stats #}
    <div class="gamification-card">
      <div class="gamification-title" id="minsidaTitle">ğŸ† NÃ½liÃ°i</div>
      <div class="gamification-stats">
        <div class="gamification-stat">
          <div class="gamification-stat-value" id="minsidaTotal">0</div>
          <div class="gamification-stat-label">MÃ¦tingar</div>
        </div>
        <div class="gamification-stat">
          <div class="gamification-stat-value" id="minsidaStreak">0 ğŸ”¥</div>
          <div class="gamification-stat-label">Vikur Ã­ rÃ¶Ã°</div>
        </div>
        <div class="gamification-stat">
          <div class="gamification-stat-value" id="minsidaRank">-</div>
          <div class="gamification-stat-label">SÃ¦ti</div>
        </div>
      </div>
    </div>

    {# Achievements #}
    <div class="card" style="margin-top: 20px;">
      <div class="section-title">ğŸ… Afrek</div>
      <div class="achievements-row" id="minsidaAchievements">
        <p style="color: var(--color-text-muted);">Engin afrek enn</p>
      </div>
    </div>

    {# Recent Attendance #}
    <div class="card" style="margin-top: 20px;">
      <div class="section-title">ğŸ“‹ SÃ­Ã°ustu mÃ¦tingar</div>
      <div id="minsidaHistory">
        <p style="color: var(--color-text-muted);">Engar mÃ¦tingar</p>
      </div>
    </div>

    {# Monthly Chart #}
    <div class="card" style="margin-top: 20px;">
      <div class="section-title">ğŸ“Š MÃ¦ting eftir mÃ¡nuÃ°um</div>
      <div class="bar-chart" id="minsidaMonthChart"></div>
    </div>

    {# Back button #}
    <button class="back-btn" onclick="goBack()" style="margin-top: 24px;">
      â† Til baka
    </button>
  </div>

  {# Error State #}
  <div id="minsidaError" style="display: none; text-align: center; padding: 40px;">
    <div style="font-size: 3rem; margin-bottom: 16px;">ğŸ˜•</div>
    <h2>Villa kom upp</h2>
    <p style="color: var(--color-text-muted);">Gat ekki sÃ³tt upplÃ½singar</p>
    <button class="btn" onclick="window.location.reload()" style="margin-top: 16px;">Reyna aftur</button>
  </div>
</div>

{# Page JS #}
<script src="/js/shared/config.js"></script>
<script src="/js/shared/utils.js"></script>
<script src="/js/shared/api.js"></script>
<script src="/js/shared/state.js"></script>
<script src="/js/components/charts.js"></script>

<script>
// Get student ID from URL
const urlParams = new URLSearchParams(window.location.search);
const studentId = urlParams.get('id');

// Initialize
document.addEventListener('DOMContentLoaded', async () => {
  if (!studentId) {
    showError();
    return;
  }

  // Set center color from URL if provided
  initCenterFromUrl();

  try {
    const stats = await apiGet('studentStats', { student_id: studentId });
    
    if (stats.status === 'error') {
      showError();
      return;
    }

    renderMinsida(stats);
  } catch (err) {
    console.error('Villa:', err);
    showError();
  }
});

function renderMinsida(data) {
  document.getElementById('minsidaLoading').style.display = 'none';
  document.getElementById('minsidaContent').style.display = 'block';

  // Basic info
  document.getElementById('minsidaNafn').textContent = data.nafn || '-';
  document.getElementById('minsidaInfo').textContent = `${data.skoli || ''} â€¢ ${data.bekkur || ''}. bekkur`;

  // Stats
  document.getElementById('minsidaTitle').textContent = `ğŸ† ${data.title || 'NÃ½liÃ°i'}`;
  document.getElementById('minsidaTotal').textContent = data.totalCount || 0;
  document.getElementById('minsidaStreak').textContent = `${data.streakWeeks || 0} ğŸ”¥`;
  document.getElementById('minsidaRank').textContent = data.rank ? `#${data.rank}` : '-';

  // Achievements
  const achievementsEl = document.getElementById('minsidaAchievements');
  if (data.achievements && data.achievements.length > 0) {
    achievementsEl.innerHTML = data.achievements.map(a => `
      <div class="achievement-badge">
        <span>${a.emoji || 'ğŸ…'}</span>
        <span>${a.name || a}</span>
      </div>
    `).join('');
  }

  // History
  const historyEl = document.getElementById('minsidaHistory');
  if (data.recentAttendance && data.recentAttendance.length > 0) {
    historyEl.innerHTML = data.recentAttendance.slice(0, 10).map(a => `
      <div class="attendance-item" style="padding: 12px 0; border-bottom: 1px solid var(--color-border);">
        <div style="font-weight: 500;">${formatFullDate(a.date)}</div>
        <div style="font-size: 0.85rem; color: var(--color-text-muted);">${a.center_name || a.center_id} â€¢ ${a.dagskrarlid || ''}</div>
      </div>
    `).join('');
  }

  // Monthly chart
  if (data.byMonth) {
    const monthData = Object.entries(data.byMonth).map(([month, count]) => ({
      label: month,
      value: count
    }));
    renderWeeklyChart('minsidaMonthChart', monthData);
  }
}

function showError() {
  document.getElementById('minsidaLoading').style.display = 'none';
  document.getElementById('minsidaError').style.display = 'block';
}

function goBack() {
  if (document.referrer) {
    window.history.back();
  } else {
    window.location.href = 'index.html';
  }
}
</script>
